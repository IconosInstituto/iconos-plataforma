"use strict";(self["webpackChunkiconos_plataforma"]=self["webpackChunkiconos_plataforma"]||[]).push([[347],{1347:(e,a,t)=>{t.r(a),t.d(a,{default:()=>U});var o=t(3673),n=t(8880),s=t(2323);const i=(0,o._)("div",{class:"text-caption"},"Periodos",-1),l={class:"col"},r={class:"col"},d={class:"col"},c={class:"col text-right"},m=(0,o.Uk)("Eliminar");function p(e,a,t,p,u,w){const g=(0,o.up)("q-input"),b=(0,o.up)("q-btn"),f=(0,o.up)("q-form"),_=(0,o.up)("q-card-section"),D=(0,o.up)("q-card"),h=(0,o.up)("q-icon"),k=(0,o.up)("q-tooltip"),y=(0,o.up)("q-td"),v=(0,o.up)("q-tr"),I=(0,o.up)("q-table"),W=(0,o.up)("q-page");return(0,o.wg)(),(0,o.j4)(W,{padding:""},{default:(0,o.w5)((()=>[(0,o.Wm)(D,{class:"shadow-24"},{default:(0,o.w5)((()=>[(0,o.Wm)(_,null,{default:(0,o.w5)((()=>[(0,o.Wm)(I,{class:"shadow-0",loading:p.loading,"no-data-label":"Sin datos",rows:p.items,columns:p.columns,pagination:p.pagination},{top:(0,o.w5)((()=>[i,(0,o.Wm)(D,{class:"shadow-24 bg-dark full-width q-my-md"},{default:(0,o.w5)((()=>[(0,o.Wm)(_,null,{default:(0,o.w5)((()=>[(0,o.Wm)(f,{class:"row q-col-gutter-md items-center",onSubmit:(0,n.iM)(p.submitNew,["prevent"])},{default:(0,o.w5)((()=>[(0,o._)("div",l,[(0,o.Wm)(g,{modelValue:p.newItem.name,"onUpdate:modelValue":a[0]||(a[0]=e=>p.newItem.name=e),label:"Nombre",standout:"bg-primary text-white",dense:"",dark:"",required:""},null,8,["modelValue"])]),(0,o._)("div",r,[(0,o.Wm)(g,{modelValue:p.newItem.startDate,"onUpdate:modelValue":a[1]||(a[1]=e=>p.newItem.startDate=e),label:"Inicio",type:"date",standout:"bg-primary text-white",dense:"",dark:""},null,8,["modelValue"])]),(0,o._)("div",d,[(0,o.Wm)(g,{modelValue:p.newItem.endDate,"onUpdate:modelValue":a[2]||(a[2]=e=>p.newItem.endDate=e),label:"Fin",type:"date",standout:"bg-primary text-white",dense:"",dark:""},null,8,["modelValue"])]),(0,o._)("div",c,[(0,o.Wm)(b,{label:"Crear periodo",color:"primary",unelevated:"","no-caps":"",disabled:""==p.newItem.name,type:"submit"},null,8,["disabled"])])])),_:1},8,["onSubmit"])])),_:1})])),_:1})])),body:(0,o.w5)((e=>[(0,o.Wm)(v,{props:e,class:(0,s.C_)(e.row.actual?"bg-blue-grey-1 text-primary":"")},{default:(0,o.w5)((()=>[(0,o.Wm)(y,{key:"actual",props:e},{default:(0,o.w5)((()=>[e.row.actual?((0,o.wg)(),(0,o.j4)(h,{key:0,name:"check",color:"primary",size:"md"})):((0,o.wg)(),(0,o.j4)(b,{key:1,icon:"check_box_outline_blank",unelevated:"",color:"primary",flat:"",size:"sm",onClick:a=>p.setPeriodo(e.row)},{default:(0,o.w5)((()=>[(0,o.Wm)(k,null,{default:(0,o.w5)((()=>[(0,o.Uk)("Asignar "+(0,s.zw)(e.row.name)+" como periodo actual.",1)])),_:2},1024)])),_:2},1032,["onClick"]))])),_:2},1032,["props"]),(0,o.Wm)(y,{class:"text-bold text-body1",key:"name",props:e},{default:(0,o.w5)((()=>[(0,o.Uk)((0,s.zw)(e.row.name),1)])),_:2},1032,["props"]),(0,o.Wm)(y,{class:"text-bold",key:"asignaciones",props:e},{default:(0,o.w5)((()=>[(0,o.Uk)((0,s.zw)(e.row.asignaciones.length),1)])),_:2},1032,["props"]),(0,o.Wm)(y,{key:"startDate",props:e},{default:(0,o.w5)((()=>[(0,o.Uk)((0,s.zw)(e.row.startDate),1)])),_:2},1032,["props"]),(0,o.Wm)(y,{key:"endDate",props:e},{default:(0,o.w5)((()=>[(0,o.Uk)((0,s.zw)(e.row.endDate),1)])),_:2},1032,["props"]),(0,o.Wm)(y,{key:"actions",props:e},{default:(0,o.w5)((()=>[(0,o.Wm)(b,{icon:"delete",onClick:a=>p.deleteItem(e.row),size:"xs",color:"negative",round:"",unelevated:""},{default:(0,o.w5)((()=>[(0,o.Wm)(k,null,{default:(0,o.w5)((()=>[m])),_:1})])),_:2},1032,["onClick"])])),_:2},1032,["props"])])),_:2},1032,["props","class"])])),_:1},8,["loading","rows","columns","pagination"])])),_:1})])),_:1})])),_:1})}var u=t(515),w=t.n(u),g=t(1959),b=t(9582),f=t(7874),_=t(8623),D=t(1082),h=t(8825);const k={components:{editThis:_.Z},setup(){const e=(0,h.Z)(),a=((0,b.yj)(),(0,f.oR)()),t=(0,g.Fl)((()=>a.getters["api/getPeriodo"])),o=(0,g.iH)(!0),n=(0,g.iH)([]),s={sortBy:"startDate",descending:!0,rowsPerPage:10},i=[{name:"actual",label:"Actual",field:"actual",align:"center"},{name:"name",label:"Nombre",field:"name",align:"left"},{name:"asignaciones",label:"Estudiantes inscritos",field:"asignaciones",align:"center"},{name:"startDate",label:"Inicio",field:"startDate",align:"center",sortable:!0},{name:"endDate",label:"Fin",field:"endDate",align:"center",sortable:!0},{name:"actions"}],l=(0,g.iH)({name:"",startDate:D.ZP.formatDate(Date.now(),"YYYY-MM-DD"),endDate:D.ZP.formatDate(Date.now(),"YYYY-MM-DD")}),r=()=>{const e=w()(w()({},l.value),{},{coll:"periodos"});a.dispatch("api/SaveItem",e).then((e=>{d(),l.value={name:"",startDate:D.ZP.formatDate(Date.now(),"YYYY-MM-DD"),endDate:D.ZP.formatDate(Date.now(),"YYYY-MM-DD")}}))},d=()=>{n.value=[],a.dispatch("api/GetAllData","periodos").then((e=>{n.value=e,o.value=!1})),a.dispatch("api/GetPeriodo")};d();const c=a=>{let t="";a.asignaciones.length>0&&(t="Se eliminarán las asignaciones de estudiantes inscritos. Los reportes de los asesores también serán eliminados."),1==a.asignaciones.length?t+="<br><br> <strong>Se eliminará "+a.asignaciones.length+" asignacion de estudiante inscrito al periodo.</strong>":a.asignaciones.length>1&&(t+="<br><br> <strong>Se eliminarán "+a.asignaciones.length+" asignaciones de estudiantes inscritos al periodo.</strong>"),e.dialog({title:"Eliminar periodo",message:t,html:!0,cancel:"Cancelar",ok:"Eliminar"}).onOk((()=>{u(a)}))};let m=0,p=0;const u=async t=>{a.dispatch("api/RemoveItem",["periodos","_id",t._id]);for(var o in t.asignaciones){const e=t.asignaciones[o],i=e._id;await a.dispatch("api/RemoveItem",["asignaciones","_id",i]);for(var n in m++,e.asesores_directores){const t=e.asesores_directores[n]._id;p++;await a.dispatch("api/RemoveItem",["asesores","_id",t])}for(var s in e.asesores_lectores){const t=e.asesores_lectores[s]._id;p++;await a.dispatch("api/RemoveItem",["asesores","_id",t])}}0==m&&0==p?e.notify("Se eliminó el periodo."):e.notify("Se eliminó el periodo con "+m+" asignaciones y "+p+" reportes de asesores."),d()},_=t=>{console.log(t),a.dispatch("api/SetPeriodo",t).then((a=>{d(),e.notify("Periodo actual modificado")}))};return{loadItem:d,loading:o,items:n,columns:i,newItem:l,submitNew:r,deleteItem:c,periodoActual:t,setPeriodo:_,pagination:s}}};var y=t(4379),v=t(151),I=t(5589),W=t(3243),Z=t(5269),Y=t(4842),q=t(8240),P=t(8186),x=t(3884),C=t(4554),Q=t(8870),S=t(7518),M=t.n(S);k.render=p;const U=k;M()(k,"components",{QPage:y.Z,QCard:v.Z,QCardSection:I.Z,QTable:W.Z,QForm:Z.Z,QInput:Y.Z,QBtn:q.Z,QTr:P.Z,QTd:x.Z,QIcon:C.Z,QTooltip:Q.Z})}}]);